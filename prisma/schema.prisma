generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
  id                  String     @id @default(uuid())
  fullName            String
  roll                String?    @unique
  instructorId        String?    @unique
  password            String
  email               String     @unique
  image               String     @default("")
  needsPasswordChange Boolean    @default(false)
  passwordChangedAt   DateTime?
  role                UserRole
  status              UserStatus @default(pending)
  isDeleted           Boolean    @default(false)
  lastLogin           DateTime   @default(now())
  otpToken            String?

  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  students    Student[]
  instructors Instructor[]

  @@map("users")
}

model Student {
  id           String     @id @default(uuid())
  fullName     String
  user         String
  users        User       @relation(fields: [user], references: [email])
  roll         String     @unique
  registration String     @unique
  department   Department
  session      String
  shift        Shift
  semester     Semester
  email        String     @unique
  number       String
  image        String     @default("")
  isDeleted    Boolean    @default(false)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("students")
}

model Instructor {
  id           String  @id @default(uuid())
  fullName     String
  user         String
  users        User    @relation(fields: [user], references: [email])
  instructorId String  @unique
  email        String  @unique
  number       String
  image        String  @default("")
  isDeleted    Boolean @default(false)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("instructors")
}

// payment
model Payment {
  id        String   @id @default(uuid())
  roll      String   @unique
  amount    String
  txnId     String
  number    String
  semester  String
  image     String?
  status    String   @default("pending")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  isDeleted Boolean  @default(false)
  repeats   Repeat[]

  @@map("payments")
}

model Repeat {
  id        String   @id @default(uuid())
  semester  String?
  subject   String[]
  payment   Payment  @relation(fields: [paymentId], references: [id])
  paymentId String

  @@map("repeats")
}

model Notice {
  id        String   @id @default(uuid())
  title     String
  pdfUrl    String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

    @@map("notices")
}





model Attendance {
  id          String   @id @default(uuid())
  date        DateTime @default(now())
  subjectCode String

  department Department
  session    String
  semester   Semester
  shift      Shift

  instructorId   String
  instructorName String

  records AttendanceRecord[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("attendances")
}

model AttendanceRecord {
  id String @id @default(uuid())

  studentRoll String
  studentName String
  status      AttendanceStatus

  attendanceId String
  attendance   Attendance @relation(fields: [attendanceId], references: [id])

  @@map("attendance_records")
}

enum AttendanceStatus {
  present
  absent
}

enum Department {
  Computer
  Civil
  Electrical
  Mechanical
  IPCT
  Electronics
  Electro_Medical
  RAC
}

enum Shift {
  First
  Second
}

enum Semester {
  First
  Second
  Third
  Fourth
  Fifth
  Sixth
  Seventh
  Eighth
}

enum UserRole {
  superAdmin
  temporaryAdmin
  student
  instructor
}

enum UserStatus {
  pending
  approved
}